<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inicio de sesión</title>
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/layout.css">
  <script src="/js/micro.js" defer></script>
</head>
<body>
  <div class="container" style="min-height:100vh; display:grid; place-items:center;">
    <div class="panel" style="width:100%; max-width:420px; padding:34px;">
      <div class="row" style="justify-content:center; gap:13px;">
        <div style="width:28px; height:28px; border-radius:999px; background:linear-gradient(180deg,#eafbf3,#d6f5e6); border:1px solid var(--color-border); box-shadow:var(--shadow-sm);"></div>
        <h2 style="margin:0;">VidaVerde</h2>
      </div>
      <div class="muted" style="text-align:center; margin-top:8px;">Conecta, recicla y gana — plataforma ecológica premium</div>
      <div class="card" style="margin-top:21px;">
        <h3>Login</h3>
        <label style="margin-top:13px;">Rol</label>
        <select id="role"></select>
        <label style="margin-top:13px;">Email</label>
        <input id="email" type="email" placeholder="correo@ejemplo.com" />
        <label style="margin-top:13px;">Password</label>
        <input id="password" type="password" placeholder="••••" />
        <button class="btn" style="margin-top:21px; width:100%;" onclick="login()">Ingresar</button>
        <div class="muted" style="text-align:center; margin-top:13px;">¿Olvidaste tu contraseña? <a href="#">Recuperar</a></div>
        <div id="out" class="list" style="margin-top:21px; padding:12px;"></div>
      </div>
    </div>
  </div>

  <script>
    function setToken(t) { localStorage.setItem('token', t); }
    function setRole(r) { localStorage.setItem('role', r); }
    function setUser(u) { localStorage.setItem('user', JSON.stringify(u)); }
    function show(el, obj) { el.textContent = JSON.stringify(obj, null, 2); }
    async function login() {
      const role = document.getElementById('role').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const url = role === 'empresa' ? '/api/auth/login/empresa' : (role === 'recolector' ? '/api/auth/login/recolector' : '/api/auth/login/usuario');
      const r = await fetch(url, { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ email, password }) });
      const j = await r.json();
      if (j.token) { setToken(j.token); setRole(role); setUser(j.usuario || j.empresa || j.recolector); window.location.href = '/dashboard.html'; return; }
      show(document.getElementById('out'), j);
    }
    // Populate roles for consistency
    (function init(){
      const sel = document.getElementById('role');
      if (!sel) return;
      ['usuario','empresa','recolector'].forEach(v=>{ const opt=document.createElement('option'); opt.value=v; opt.textContent=v.charAt(0).toUpperCase()+v.slice(1); sel.appendChild(opt); });
    })();
  </script>
</body>
</html>
